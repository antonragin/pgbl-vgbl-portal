{% extends "base.html" %}
{% block title %}Funds - Admin{% endblock %}
{% block nav_brand %}Admin Panel{% endblock %}

{% block content %}
<h1>Funds</h1>
<a href="{{ url_for('admin.dashboard') }}">&larr; Dashboard</a>

<article>
    <header>Add Fund</header>
    <form method="post" enctype="multipart/form-data">
        <div class="grid">
            <label>
                Name
                <input type="text" name="name" required placeholder="e.g. Renda Fixa DI">
            </label>
            <label>
                CNPJ
                <input type="text" name="cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
            </label>
            <label>
                Investor Type
                <select name="is_qualified_only">
                    <option value="0">Retail</option>
                    <option value="1">Qualified Only</option>
                </select>
            </label>
        </div>
        <div class="grid">
            <label>
                Initial NAV
                <input type="number" name="initial_nav" value="10.00" step="0.01" min="0.01">
            </label>
            <label>
                Returns CSV (month, return)
                <input type="file" name="returns_csv" accept=".csv">
            </label>
        </div>
        <label>
            Description
            <textarea name="description" placeholder="Investment strategy, fees, etc."></textarea>
        </label>
        <button type="submit">Create Fund</button>
    </form>
</article>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>CNPJ</th>
            <th>Type</th>
            <th>Initial NAV</th>
            <th>Current NAV</th>
            <th>Returns</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for fd in fund_data %}
        {% set f = fd.fund %}
        <tr>
            <td>{{ f.id }}</td>
            <td>{{ f.name }}</td>
            <td>{{ f.cnpj or '-' }}</td>
            <td>{{ 'Qualified' if f.is_qualified_only else 'Retail' }}</td>
            <td>R${{ "%.4f"|format(f.initial_nav) }}</td>
            <td>R${{ "%.4f"|format(f.current_nav) }}</td>
            <td>{{ fd.return_count }} months</td>
            <td>
                <a href="{{ url_for('admin.edit_fund', fund_id=f.id) }}" style="font-size:0.8em">Edit</a>
                <form method="post" action="{{ url_for('admin.delete_fund', fund_id=f.id) }}" style="margin:0;display:inline">
                    <button type="submit" class="secondary outline" style="padding:0.2em 0.5em;font-size:0.8em"
                            onclick="return confirmAction('Delete fund {{ f.name }}?')">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr><td colspan="8">No funds yet.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
